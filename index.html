<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YNS GALAXY - LIVE STATUS</title>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: white; font-family: sans-serif; }
        .glass { background: rgba(30, 30, 30, 0.9); border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .online-dot { width: 12px; height: 12px; background: #22c55e; border-radius: 50%; border: 2px solid #000; position: absolute; top: 5px; right: 5px; box-shadow: 0 0 8px #22c55e; }
        .offline-dot { width: 12px; height: 12px; background: #6b7280; border-radius: 50%; border: 2px solid #000; position: absolute; top: 5px; right: 5px; }
    </style>
</head>
<body class="p-4 pb-24">

    <header class="flex justify-between items-center mb-6">
        <h1 class="text-pink-600 font-black italic text-xl">YNS GALAXY</h1>
        <div class="bg-white/10 px-3 py-1 rounded-full text-xs">üíé <span id="my-coins">0</span></div>
    </header>

    <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Online Users</h2>
    
    <div id="user-list" class="grid grid-cols-2 gap-4">
        </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBwDUe5E8qRY1dbZzUQJu9eCAKBS7YSHVU",
            authDomain: "live-e6771.firebaseapp.com",
            projectId: "live-e6771",
            storageBucket: "live-e6771.firebasestorage.app",
            messagingSenderId: "570901004231",
            appId: "1:570901004231:web:220679cf41cf55b98023e2"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        auth.onAuthStateChanged(user => {
            if (user) {
                // ‡∑É‡∂∂‡∑ê‡∂≥‡∑í‡∑Ä ‡∑É‡∑í‡∂ß‡∑í‡∂± ‡∂∂‡∑Ä ‡∑É‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ (Online Status)
                db.collection('profiles').doc(user.uid).set({ online: true }, { merge: true });
                
                // ‡∂á‡∂¥‡∑ä ‡∂ë‡∂ö‡∑ô‡∂±‡∑ä ‡∂Ö‡∂∫‡∑í‡∂±‡∑ä ‡∑Ä‡∂± ‡∑Ä‡∑í‡∂ß Offline ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                window.addEventListener('beforeunload', () => {
                    db.collection('profiles').doc(user.uid).update({ online: false });
                });

                loadUsers();
                loadMyCoins(user.uid);
            }
        });

        function loadMyCoins(uid) {
            db.collection('profiles').doc(uid).onSnapshot(doc => {
                if(doc.exists) document.getElementById('my-coins').innerText = doc.data().coins || 0;
            });
        }

        function loadUsers() {
            db.collection('profiles').onSnapshot(snapshot => {
                const list = document.getElementById('user-list');
                list.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if(doc.id === auth.currentUser.uid) return; // ‡∂≠‡∂∏‡∂±‡∑ä‡∑Ä ‡∂Ω‡∑í‡∑É‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö‡∑ö ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∑ê‡∂≠

                    const statusClass = data.online ? 'online-dot' : 'offline-dot';
                    
                    list.innerHTML += `
                        <div class="glass p-4 relative flex flex-col items-center">
                            <div class="${statusClass}"></div>
                            <img src="${data.profilePic || 'https://i.pravatar.cc/100'}" class="w-16 h-16 rounded-full border-2 border-pink-600 mb-2 object-cover">
                            <p class="text-xs font-bold truncate w-full text-center">${data.name || 'User'}</p>
                            <button onclick="followUser('${doc.id}')" class="mt-3 bg-pink-600 px-4 py-1 rounded-full text-[10px] font-bold">FOLLOW</button>
                        </div>
                    `;
                });
            });
        }

        function followUser(uid) {
            alert("‡∂î‡∂∂ ‡∂∏‡∑ô‡∂∏ ‡∂¥‡∂ª‡∑í‡∑Å‡∑ì‡∂Ω‡∂ö‡∂∫‡∑è Follow ‡∂ö‡∑Ö‡∑è!");
            // ‡∂∏‡∑ô‡∂≠‡∂±‡∂ß Follow logic ‡∂ë‡∂ö ‡∂¥‡∑É‡∑î‡∑Ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö
        }
    </script>
</body>
</html>
